<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#fd79a8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Marble Jar - Marble Count</title>
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <header>
            <h1>Marble Jar</h1>
            <div class="subtitle-row">
                <p class="subtitle">Tap the lid to add a marble</p>
                <button type="button" class="undo-marble-btn header-undo-btn" id="undoMarbleBtn" title="Undo last marble" aria-label="Undo last marble"><img class="undo-btn-icon" src="https://cdn-icons-png.flaticon.com/128/1694/1694021.png" alt=""></button>
            </div>
        </header>

        <main>
            <div class="jar-section">
                <div class="jar-container jar-classic" id="jarContainer">
                    <canvas id="jarCanvas"></canvas>
                    <div class="jar-overlay">
                        <svg class="jar-fill-full" viewBox="0 0 304 390" preserveAspectRatio="none" aria-hidden="true">
                            <path d="M88 40 L88 78 L52 124 L44 132 L44 330 Q44 370 84 370 L220 370 Q260 370 260 330 L260 132 L252 124 L216 78 L216 40 Z"></path>
                        </svg>
                        <svg class="jar-outline-full" viewBox="0 0 304 390" preserveAspectRatio="none" aria-hidden="true">
                            <path d="M88 40 L88 78 L52 124 L44 132 L44 330 Q44 370 84 370 L220 370 Q260 370 260 330 L260 132 L252 124 L216 78 L216 40"></path>
                        </svg>
                        <div class="jar-lid"></div>
                    </div>
                    <div class="shake-hint" id="shakeHint">
                        <span class="shake-hint-text"><img class="shake-hint-icon" src="https://cdn-icons-png.flaticon.com/128/456/456291.png" alt=""> Drag</span>
                        <span class="zoom-hint-slot" id="zoomHintSlot">
                            <button type="button" class="zoom-jar-btn" id="zoomJarBtn" title="Zoom in jar" aria-label="Zoom in jar" aria-pressed="false">Zoom In</button>
                        </span>
                    </div>
                </div>
                <div class="zoom-center-row" id="zoomCenterSlot"></div>
                <div class="jar-stats">
                    <span id="marbleCount">0</span> <span id="marbleCountLabel">marbles collected</span>
                </div>
                <div class="menu-dock" id="frontControls">
                    <button type="button" class="menu-toggle-btn" id="menuToggleBtn" aria-expanded="false" aria-controls="frontMenu">Menu</button>
                </div>
            </div>
        </main>

        <div class="menu-backdrop" id="menuBackdrop" aria-hidden="true"></div>
        <div class="front-menu" id="frontMenu">
            <a href="collection.html" class="menu-link" id="menuCollectionLink">View Collection</a>
            <button type="button" class="menu-link settings-menu-btn" id="settingsBtn" title="Settings">Settings</button>
            <button type="button" class="sync-badge sync-unknown" id="syncBadge">Sync: Checking...</button>
        </div>

        <!-- Settings Page -->
        <div class="settings-page" id="settingsPage">
            <div class="settings-content">
                <h2 class="settings-title">Settings</h2>
                <div class="settings-group">
                    <h3>Choose Your Collectible</h3>
                    <div class="collectible-bulk-actions">
                        <button type="button" class="collectible-bulk-btn" id="selectAllCollectiblesBtn">Select All</button>
                        <button type="button" class="collectible-bulk-btn secondary" id="deselectAllCollectiblesBtn">Deselect All</button>
                    </div>
                    <div class="collectible-picker" id="collectiblePicker">
                        <!-- Collectibles will be dynamically rendered -->
                    </div>
                </div>

                <div class="settings-group">
                    <h3>Collision Sounds</h3>
                    <div class="sound-theme-picker" id="soundThemePicker">
                        <!-- Sound themes will be dynamically rendered -->
                    </div>
                </div>

                <div class="settings-group" id="syncGroup">
                    <h3>Sync Across Devices</h3>
                    <div id="syncStatus">
                        <!-- Rendered by app.js -->
                    </div>
                    <div id="syncAuthForm" class="sync-auth-form" style="display: none;">
                        <input type="email" id="syncEmail" placeholder="Email" autocomplete="email">
                        <input type="password" id="syncPassword" placeholder="Password" autocomplete="current-password">
                        <div class="sync-auth-buttons">
                            <button type="button" class="sync-btn" id="syncSignInBtn">Sign In</button>
                            <button type="button" class="sync-btn sync-btn-secondary" id="syncSignUpBtn">Sign Up</button>
                        </div>
                    </div>
                    <p class="sync-hint" id="syncHint">Sign in to sync your jar across devices.</p>
                </div>

                <div class="settings-group">
                    <h3>Data</h3>
                    <div class="settings-inline-row">
                        <label for="settingsCapacityInput" class="settings-inline-label">Jar capacity</label>
                        <div class="settings-inline-controls settings-capacity-controls">
                            <button type="button" class="settings-inline-btn secondary" id="settingsCapacityDownBtn" aria-label="Decrease jar capacity">-</button>
                            <input type="number" id="settingsCapacityInput" min="10" max="500" step="1" value="100">
                            <button type="button" class="settings-inline-btn secondary" id="settingsCapacityUpBtn" aria-label="Increase jar capacity">+</button>
                            <button type="button" class="settings-inline-btn" id="settingsApplyCapacityBtn">Apply</button>
                        </div>
                    </div>
                    <div class="settings-inline-row">
                        <label for="settingsMarbleCountInput" class="settings-inline-label">Set marbles in jar</label>
                        <div class="settings-inline-controls">
                            <input type="number" id="settingsMarbleCountInput" min="0" max="100" step="1" value="0">
                            <button type="button" class="settings-inline-btn" id="settingsApplyCountBtn">Apply</button>
                        </div>
                    </div>
                    <button class="danger-btn subtle" id="settingsClearCollectiblesBtn"><img class="btn-icon" src="https://cdn-icons-png.flaticon.com/128/1669/1669005.png" alt=""> Clear Items Collected So Far</button>
                    <button class="danger-btn" id="settingsResetBtn"><img class="btn-icon" src="https://cdn-icons-png.flaticon.com/128/1890/1890119.png" alt=""> Empty Jar</button>
                </div>
            </div>
        </div>

        <!-- Marble Zoom Modal -->
        <div class="marble-zoom-overlay" id="marbleZoomOverlay" aria-hidden="true">
            <div class="marble-zoom-modal">
                <button class="marble-zoom-close" id="marbleZoomClose" aria-label="Close">×</button>
                <div class="marble-zoom-content" id="marbleZoomContent">
                    <!-- Marble preview injected by JS -->
                </div>
            </div>
        </div>

        <!-- Jar Inspect Zoom Overlay -->
        <div class="jar-inspect-overlay" id="jarInspectOverlay" aria-hidden="true">
            <div class="jar-inspect-modal">
                <button class="jar-inspect-close" id="jarInspectClose" aria-label="Close">×</button>
                <div class="jar-inspect-viewport" id="jarInspectViewport">
                    <canvas id="jarInspectCanvas"></canvas>
                </div>
                <p class="jar-inspect-hint">Drag to pan</p>
            </div>
        </div>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="livereload.js"></script>
    <script src="utils.js"></script>
    <script src="collectibles-data.js"></script>
    <script src="sync-config.js"></script>
    <script src="sync.js"></script>
    <script src="app.js"></script>
    <script src="version.js"></script>
    <script src="pwa-register.js"></script>
</body>
</html>
