<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#fd79a8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Marble Jar - Marble Count</title>
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <header>
            <h1>Marble Jar</h1>
            <p class="subtitle">Tap the lid to add a marble</p>
        </header>

        <main>
            <div class="jar-section">
                <div class="jar-container jar-classic" id="jarContainer">
                    <canvas id="jarCanvas"></canvas>
                    <div class="jar-overlay">
                        <div class="jar-glass"></div>
                        <div class="jar-lid"></div>
                        <div class="jar-shine"></div>
                    </div>
                    <div class="shake-hint" id="shakeHint">
                        <span>üëÜ Drag or shake!</span>
                    </div>
                </div>
                <div class="jar-stats">
                    <span id="marbleCount">0</span> <span id="marbleCountLabel">marbles collected</span>
                    <button type="button" class="undo-marble-btn" id="undoMarbleBtn" title="Undo last marble" aria-label="Undo last marble"><img class="undo-btn-icon" src="https://cdn-icons-png.flaticon.com/128/225/225453.png" alt=""></button>
                </div>
                <div class="header-actions">
                    <a href="collection.html" class="collection-link">View Collection</a>
                    <button class="settings-btn" id="settingsBtn" title="Settings"><img class="settings-btn-icon" src="https://cdn-icons-png.flaticon.com/128/1790/1790071.png" alt=""></button>
                </div>
                <div class="sync-badge sync-unknown" id="syncBadge">Sync: Checking...</div>
            </div>
        </main>

        <!-- Settings Page -->
        <div class="settings-page" id="settingsPage">
            <div class="settings-header">
                <button class="settings-back-btn" id="settingsBackBtn">‚Üê Back</button>
                <h2>Settings</h2>
            </div>
            <div class="settings-content">
                <div class="settings-group">
                    <h3>Choose Your Collectible</h3>
                    <div class="collectible-bulk-actions">
                        <button type="button" class="collectible-bulk-btn" id="selectAllCollectiblesBtn">Select All</button>
                        <button type="button" class="collectible-bulk-btn secondary" id="deselectAllCollectiblesBtn">Deselect All</button>
                    </div>
                    <div class="collectible-picker" id="collectiblePicker">
                        <!-- Collectibles will be dynamically rendered -->
                    </div>
                </div>

                <div class="settings-group">
                    <h3>Collision Sounds</h3>
                    <div class="sound-theme-picker" id="soundThemePicker">
                        <!-- Sound themes will be dynamically rendered -->
                    </div>
                </div>

                <div class="settings-group" id="syncGroup">
                    <h3>Sync Across Devices</h3>
                    <div id="syncStatus">
                        <!-- Rendered by app.js -->
                    </div>
                    <div id="syncAuthForm" class="sync-auth-form" style="display: none;">
                        <input type="email" id="syncEmail" placeholder="Email" autocomplete="email">
                        <input type="password" id="syncPassword" placeholder="Password" autocomplete="current-password">
                        <div class="sync-auth-buttons">
                            <button type="button" class="sync-btn" id="syncSignInBtn">Sign In</button>
                            <button type="button" class="sync-btn sync-btn-secondary" id="syncSignUpBtn">Sign Up</button>
                        </div>
                    </div>
                    <p class="sync-hint" id="syncHint">Sign in to sync your jar across devices.</p>
                </div>

                <div class="settings-group">
                    <h3>Data</h3>
                    <div class="settings-inline-row">
                        <label for="settingsMarbleCountInput" class="settings-inline-label">Set marbles in jar</label>
                        <div class="settings-inline-controls">
                            <input type="number" id="settingsMarbleCountInput" min="0" max="5000" step="1" value="0">
                            <button type="button" class="settings-inline-btn" id="settingsApplyCountBtn">Apply</button>
                        </div>
                    </div>
                    <button class="danger-btn subtle" id="settingsClearCollectiblesBtn"><img class="btn-icon" src="https://cdn-icons-png.flaticon.com/128/1669/1669005.png" alt=""> Clear Items Collected So Far</button>
                    <button class="danger-btn" id="settingsResetBtn"><img class="btn-icon" src="https://cdn-icons-png.flaticon.com/128/1890/1890119.png" alt=""> Empty Jar</button>
                </div>
            </div>
        </div>

        <!-- Marble Zoom Modal -->
        <div class="marble-zoom-overlay" id="marbleZoomOverlay" aria-hidden="true">
            <div class="marble-zoom-modal">
                <button class="marble-zoom-close" id="marbleZoomClose" aria-label="Close">√ó</button>
                <div class="marble-zoom-content" id="marbleZoomContent">
                    <!-- Marble preview injected by JS -->
                </div>
            </div>
        </div>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="livereload.js"></script>
    <script src="utils.js"></script>
    <script src="collectibles-data.js"></script>
    <script src="sync-config.js"></script>
    <script src="sync.js"></script>
    <script src="app.js"></script>
    <script src="version.js"></script>
    <script src="pwa-register.js"></script>
</body>
</html>
